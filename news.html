<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EYES OF 3080</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#003c94">
<link rel="apple-touch-icon" href="icons/icon-192x192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
/>

<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
    font-family:Segoe UI,Tahoma,sans-serif;
    background:#f4f6f5;
    color:#222;
}


/* ================= HEADER ================= */
header{
  background:linear-gradient(135deg,#2d5016,#4a7c2a);
  color:#fff;
  position:sticky;
  top:0;
  z-index:1000;
}

.header-container{
  max-width:1200px;
  margin:auto;
  padding:15px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.logo-wrap{
  display:flex;
  align-items:center;
  gap:10px;
  text-decoration:none;
}

.logo-img{
  width:38px;
  height:38px;
  object-fit:contain;
}

.logo-text{
  font-size:1.5rem;
  font-weight:bold;
  color:#fff;
}

/* Hamburger */
.hamburger{
  border:none;
  background:none;
  cursor:pointer;
  display:flex;
  flex-direction:column;
  gap:5px;
}
.hamburger span{
  width:28px;
  height:3px;
  background:#fff;
  border-radius:3px;
  transition:.3s;
}
.hamburger.active span:nth-child(1){
  transform:rotate(45deg) translate(6px,6px)
}
.hamburger.active span:nth-child(2){
  opacity:0
}
.hamburger.active span:nth-child(3){
  transform:rotate(-45deg) translate(6px,-6px)
}

/* ================= HEADER ACTIONS ================= */
.header-actions{
  display:flex;
  align-items:center;
  gap:18px;
}

/* ================= NOTIFICATION ICON ================= */
.notification-btn{
  position:relative;
  color:#fff;
  text-decoration:none;
  display:flex;
  align-items:center;
}

.notification-btn i{
  font-size:1.45rem;
}

/* ================= BADGE ================= */
.notification-btn .badge{
  position:absolute;
  top:-6px;
  right:-8px;
  background:#e63946;
  color:#fff;
  font-size:.7rem;
  font-weight:700;
  padding:3px 6px;
  border-radius:50%;
  min-width:18px;
  height:18px;
  display:flex;
  align-items:center;
  justify-content:center;
  line-height:1;
}

/* ================= SIDEBAR ================= */
.sidebar{
  position:fixed;
  top:0;
  right:-300px;
  width:300px;
  height:100vh;
  background:#2d5016;
  transition:.3s;
  z-index:2000;
}
.sidebar.active{right:0}

.sidebar-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:20px;
  color:#fff;
  border-bottom:1px solid rgba(255,255,255,.2);
}

.close-btn{
  background:none;
  border:none;
  color:#fff;
  font-size:2rem;
  cursor:pointer;
}

.nav-menu{
  list-style:none;
}
.nav-menu a{
  display:block;
  padding:15px 20px;
  color:#fff;
  text-decoration:none;
}
.nav-menu a:hover{
  background:rgba(255,255,255,.1);
}

/* Overlay */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  display:none;
  z-index:1500;
}
.overlay.active{display:block}

/* ================= MAIN ================= */
.container{
    max-width:1100px;
    margin:30px auto;
    padding:0 20px;
}

h1{
    margin-bottom:20px;
    color:#2d5016;
}

/* ================= POST ================= */
.post{
    background:#fff;
    margin-bottom:25px;
    padding:18px;
    border-radius:8px;
    box-shadow:0 2px 8px rgba(0,0,0,.08);
}

.post-header{
    display:flex;
    gap:15px;
    align-items:center;
    margin-bottom:10px;
}

.post-thumb{
    width:90px;
    height:70px;
    background:linear-gradient(135deg,#dcedc8,#c5e1a5);
    border-radius:6px;
    flex-shrink:0;
    background-size:cover;
    background-position:center;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:600;
    color:#2d5016;
}

.post-title{
    font-size:1.1rem;
    font-weight:700;
    color:#2d5016;
}

.post-excerpt{
    font-size:.95rem;
    color:#555;
    line-height:1.6;
    margin-bottom:12px;
}

.read-more{
    font-size:.9rem;
    color:#2d5016;
    font-weight:600;
    cursor:pointer;
    text-decoration:underline;
}

.post-meta{
    display:flex;
    justify-content:space-between;
    font-size:.85rem;
    color:#777;
}

.views{
    font-weight:600;
    color:#4a7c2a;
}
.views::before{content:"";}

/* ===== JOIN CARD HEADER ===== */
.join-header{
  display:flex;
  align-items:center;
  gap:16px;
  margin-bottom:14px;
}

.join-logo{
  width:64px;
  height:64px;
  border-radius:12px;
  object-fit:contain;
  background:#f0f7f2;
  padding:6px;
}

.join-card h3{
  font-size:1.25rem;
  font-weight:700;
  color:#2d5016;
  margin:0;
}

/* underline stays aligned */
.join-card h3::after{
  content:"";
  display:block;
  width:55px;
  height:3px;
  background:#4a7c2a;
  margin-top:6px;
  border-radius:2px;
}

/* ================= JOIN CHANNEL – MATCH NEWS ================= */
.join-card-container{
  margin:20px auto 30px;
  max-width:900px;
  padding:0 15px;
}

.join-card{
  background:#ffffff;
  border-radius:14px;
  padding:22px;
  box-shadow:0 6px 14px rgba(0,0,0,0.08);
  border-left:5px solid #2d5016;
}

.join-card h3{
  font-size:1.25rem;
  font-weight:700;
  color:#2d5016;
  margin-bottom:10px;
}

.join-card h3::after{
  content:"";
  display:block;
  width:60px;
  height:3px;
  background:#4a7c2a;
  margin-top:6px;
  border-radius:2px;
}

.join-card p{
  font-size:.95rem;
  line-height:1.6;
  color:#555;
  margin-bottom:16px;
}

.join-card a{
  display:inline-block;
  padding:10px 18px;
  background:#2d5016;
  color:#ffffff;
  text-decoration:none;
  border-radius:8px;
  font-weight:600;
  font-size:.9rem;
}

.join-card a:hover{
  background:#3f6f22;
}

</style>
</head>

<body>

<header>
  <div class="header-container">

    <a href="index.html" class="logo-wrap">
      <img src="https://zvnovocoayqomdilidte.supabase.co/storage/v1/object/public/uploads/6a8f3e57-3d27-47f5-9b5e-22a7070fc442.jpeg" class="logo-img">
      <span class="logo-text">EYES OF 3080</span>
    </a>

    <div class="header-actions">
      <a href="notifications.html" class="notification-btn">
        <i class="fa-regular fa-bell"></i>
        <span class="badge" id="notifCount">0</span>
      </a>

      <button class="hamburger" id="hamburger">
        <span></span><span></span><span></span>
      </button>
    </div>

  </div>
</header>

<nav class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <h3>Menu</h3>
    <button class="close-btn" id="closeBtn">&times;</button>
  </div>
  <ul class="nav-menu">
    <li><a href="news.html">Home</a></li>
    <li><a href="pdf.html">PDFs</a></li>
      <li><a href="downloads.html">Downloads</a></li>
    <li><a href="cbt_welcome.html">CBT</a></li>
    <li><a href="marketplace.html">Marketplace</a></li>
   <li><a href="profile.html">Profile</a></li>
  </ul>
</nav>

<div class="overlay" id="overlay"></div>

<div class="join-card-container">
  <div class="join-card">

    <div class="join-header">
      <img
        src="https://zvnovocoayqomdilidte.supabase.co/storage/v1/object/public/uploads/6a8f3e57-3d27-47f5-9b5e-22a7070fc442.jpeg"
        alt="EYES OF 3080"
        class="join-logo"
      >
      <h3>Join Our Channel</h3>
    </div>

    <p>
      Stay updated with the latest PDFs, announcements, and important academic
      resources shared directly with students.
    </p>

    <a href="https://whatsapp.com/channel/0029VbCGrZX0wajtgI9JvU1n" target="_blank">Join Now</a>
  </div>
</div>

<div class="container">
  <h1>Latest News</h1>
  <div id="postsContainer"></div>
</div>


<style>
.latest-docs{
  max-width:900px; /* make it wider */
  margin:20px auto;
  padding:0 20px;
}

/* SINGLE CARD INCLUDING HEADER */
.doc-card{
  background:#fff;
  border:1px solid #e5e7eb;
  border-radius:14px;
  padding:25px;
  margin-bottom:18px;
  text-align:left;
}

/* Section header inside the card */
.section-header{
  margin-bottom:25px;
}

.section-title{
  font-size:1.3rem;
  font-weight:700;
  color:#2d7c31;
  display:inline-block;
  border-bottom:3px solid #2d7c31; /* green underline */
  padding-bottom:3px;
}

.section-header small{
  display:block;
  color:#555;
  margin-top:5px;
}

/* Document item inside single card */
.doc-item{
  text-align:center;
  padding:25px 0;
  border-bottom:1px solid #e5e7eb;
}

.doc-item:last-child{
  border-bottom:none;
}

/* PDF icon on top */
.doc-icon{
  width:60px;
  height:60px;
  margin:0 auto 15px;
}

.doc-icon img{
  width:100%;
  height:100%;
  object-fit:contain;
}

/* Document text */
.doc-text{
  margin-top:10px;
}

.doc-title{
  font-size:1.1rem;
  font-weight:700;
  margin-bottom:5px;
}

.doc-subtitle{
  font-size:.9rem;
  color:#666;
  margin-bottom:12px;
}

/* Actions */
.doc-actions{
  display:flex;
  justify-content:center;
  gap:12px;
  margin-top:8px;
}

.btn{
  border:none;
  padding:9px 16px;
  border-radius:8px;
  font-size:.9rem;
  cursor:pointer;
  text-decoration:none;
}

.btn.copy{
  background:#4caf50;
  color:#fff;
}

.btn.download{
  background:#f9a825;
  color:#fff;
}
</style>

<div class="latest-docs">

  <!-- SINGLE CARD WITH HEADER + DOCS -->
  <div class="doc-card">

    <!-- HEADER INSIDE CARD -->
    <div class="section-header">
      <div class="section-title">Latest Documents</div>
      <small>View more on the course page</small>
    </div>

    <div class="doc-list">

      <!-- DOC 1 -->
      <div class="doc-item">
        <div class="doc-icon">
          <img src="https://upload.wikimedia.org/wikipedia/commons/8/87/PDF_file_icon.svg" alt="PDF">
        </div>
        <div class="doc-text">
          <div class="doc-title">2026 UTME JAMB REGISTRATION TEMPLATE</div>
          <div class="doc-subtitle">Document ready for download</div>
          <div class="doc-actions">
            <button class="btn copy" data-link="https://zvnovocoayqomdilidte.supabase.co/storage/v1/object/public/uploads/courses/2026_JAMB_UTME_REGISTRATION_TEMPLATE.pdf">Copy Link</button>
            <a href="https://zvnovocoayqomdilidte.supabase.co/storage/v1/object/public/uploads/courses/2026_JAMB_UTME_REGISTRATION_TEMPLATE.pdf" class="btn download" target="_blank">Download</a>
          </div>
        </div>
      </div>

      <!-- DOC 2 -->
      <div class="doc-item">
        <div class="doc-icon">
          <img src="https://upload.wikimedia.org/wikipedia/commons/8/87/PDF_file_icon.svg" alt="PDF">
        </div>
        <div class="doc-text">
          <div class="doc-title">ORGANISATIONOFGOVERNMENT6-POL103</div>
          <div class="doc-subtitle">Document ready for download</div>
          <div class="doc-actions">
            <button class="btn copy" data-link="https://zvnovocoayqomdilidte.supabase.co/storage/v1/object/public/uploads/courses/POL103/1768397885110-ORGANISATIONOFGOVERNMENT6-POL103.pdf">Copy Link</button>
            <a href="https://zvnovocoayqomdilidte.supabase.co/storage/v1/object/public/uploads/courses/POL103/1768397885110-ORGANISATIONOFGOVERNMENT6-POL103.pdf" class="btn download" target="_blank">Download</a>
          </div>
        </div>
      </div>

      <!-- DOC 3 -->
      <div class="doc-item">
        <div class="doc-icon">
          <img src="https://upload.wikimedia.org/wikipedia/commons/8/87/PDF_file_icon.svg" alt="PDF">
        </div>
        <div class="doc-text">
          <div class="doc-title">INTRODUCTIONTOAFRICANSOCIETIES</div>
          <div class="doc-subtitle">Document ready for download</div>
          <div class="doc-actions">
            <button class="btn copy" data-link="https://zvnovocoayqomdilidte.supabase.co/storage/v1/object/public/uploads/courses/SOC103/1768397831366-INTRODUCTIONTOAFRICANSOCIETIESANDCULTUREWEEK163-SOC103.pdf">Copy Link</button>
            <a href="https://zvnovocoayqomdilidte.supabase.co/storage/v1/object/public/uploads/courses/SOC103/1768397831366-INTRODUCTIONTOAFRICANSOCIETIESANDCULTUREWEEK163-SOC103.pdf" class="btn download" target="_blank">Download</a>
          </div>
        </div>
      </div>

      <!-- DOC 4 -->
      <div class="doc-item">
        <div class="doc-icon">
          <img src="https://upload.wikimedia.org/wikipedia/commons/8/87/PDF_file_icon.svg" alt="PDF">
        </div>
        <div class="doc-text">
          <div class="doc-title">PAYMENT OF TUITION FEES FOR THE 2025/2026 ACADEMIC SESSION</div>
          <div class="doc-subtitle">Document ready for download</div>
          <div class="doc-actions">
            <button class="btn copy" data-link="https://zvnovocoayqomdilidte.supabase.co/storage/v1/object/public/uploads/PAYMENTOFTUITIONFEESFORTHE20252026ACADEMIC2512191702365-General100LVL.pdf">Copy Link</button>
            <a href="https://zvnovocoayqomdilidte.supabase.co/storage/v1/object/public/uploads/PAYMENTOFTUITIONFEESFORTHE20252026ACADEMIC2512191702365-General100LVL.pdf" class="btn download" target="_blank">Download</a>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>




<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
document.addEventListener("DOMContentLoaded", async () => {

  /* ===== SUPABASE ===== */
  const supabase = window.supabase.createClient(
    "https://zvnovocoayqomdilidte.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp2bm92b2NvYXlxb21kaWxpZHRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQwMDM2OTgsImV4cCI6MjA3OTU3OTY5OH0.PcpwASQ3RBRoQVIglxKz-yM3iuYMZMtyQJBh8QNHad8"
  );

  /* ===== HAMBURGER MENU ===== */
  const hamburger = document.getElementById("hamburger");
  const sidebar   = document.getElementById("sidebar");
  const overlay   = document.getElementById("overlay");
  const closeBtn  = document.getElementById("closeBtn");

  if(!hamburger || !sidebar || !overlay || !closeBtn){
    console.error("❌ Hamburger elements missing");
  } else {
    function toggleMenu(){
      console.log("Hamburger toggled"); // test
      hamburger.classList.toggle("active");
      sidebar.classList.toggle("active");
      overlay.classList.toggle("active");
    }

    hamburger.addEventListener("click", toggleMenu);
    closeBtn.addEventListener("click", toggleMenu);
    overlay.addEventListener("click", toggleMenu);

    document.querySelectorAll(".nav-menu a").forEach(link => {
      link.addEventListener("click", toggleMenu);
    });

    console.log("✅ Hamburger initialized");
  }

 /* ===== LOAD POSTS ===== */
const container = document.getElementById("postsContainer");
if(container){
  const {data, error} = await supabase
    .from("posts")
    .select("*")
    .order("created_at", { ascending:false });

  if(error){
    console.error("❌ Failed loading posts", error);
    container.innerHTML = "<p>Error loading posts</p>";
  } else if(!data || data.length === 0){
    container.innerHTML = "<p>No news available.</p>";
  } else {
    container.innerHTML = "";
    data.forEach(post => {
      const div = document.createElement("div");
      div.className = "post";

      // Updated thumbnail: uses logo if no image
      const thumb = post.image_url
        ? `<div class="post-thumb" style="background-image:url('${post.image_url}'); background-size: cover; background-position: center;"></div>`
        : `<div class="post-thumb" style="background-image:url('https://zvnovocoayqomdilidte.supabase.co/storage/v1/object/public/uploads/6a8f3e57-3d27-47f5-9b5e-22a7070fc442.jpeg'); background-size: cover; background-position: center;"></div>`;

      const excerpt = post.content?.length > 120
        ? post.content.slice(0,120) + "..."
        : post.content || "";

      div.innerHTML = `
        <div class="post-header">
          ${thumb}
          <div class="post-title">${post.title}</div>
        </div>
        <div class="post-excerpt">${excerpt}</div>
        <div class="read-more">Read More</div>
        <div class="post-meta">
          <span class="views">${post.views || 0}</span>
          <span>${new Date(post.created_at).toLocaleDateString()}</span>
        </div>
      `;

      div.querySelector(".read-more").onclick = () => {
        window.location.href = "post.html?id=" + post.id;
      };

      container.appendChild(div);
    });
    console.log("✅ Posts loaded");
  }
}
});

// Function to copy link to clipboard
document.querySelectorAll('.btn.copy').forEach(button => {
  button.addEventListener('click', () => {
    // Get the closest card
    const card = button.closest('.doc-card, .video-card');

    // Determine the link to copy
    let link = '';
    if(card.classList.contains('doc-card')){
      // For PDFs, get the download link if present
      const downloadBtn = card.querySelector('.btn.download');
      link = downloadBtn ? downloadBtn.href : '';
    } else if(card.classList.contains('video-card')){
      // For videos, get the source link
      const video = card.querySelector('video source');
      link = video ? video.src : '';
    }

    if(!link){
      alert('No link found to copy.');
      return;
    }

    // Copy to clipboard
    navigator.clipboard.writeText(link).then(() => {
      button.textContent = 'Copied!';
      setTimeout(() => button.textContent = 'Copy Link', 1500);
    }).catch(err => {
      console.error('Failed to copy: ', err);
    });
  });
});

document.addEventListener("DOMContentLoaded", async () => {

  const supabaseClient = supabase.createClient(
    "https://zvnovocoayqomdilidte.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp2bm92b2NvYXlxb21kaWxpZHRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQwMDM2OTgsImV4cCI6MjA3OTU3OTY5OH0.PcpwASQ3RBRoQVIglxKz-yM3iuYMZMtyQJBh8QNHad8"
  );

  let currentUser = null;
  let lastSeen = "1970-01-01";

  /* ================= AUTH ================= */
  const { data:{ session } } = await supabaseClient.auth.getSession();
  if (!session?.user) return;

  currentUser = session.user;

  /* ================= GET LAST SEEN ================= */
  const { data: profile } = await supabaseClient
    .from("profiles")
    .select("last_notification_seen_at")
    .eq("id", currentUser.id)
    .maybeSingle();

  lastSeen = profile?.last_notification_seen_at || "1970-01-01";

  /* ================= UPDATE BADGE ================= */
  async function updateBadge() {
    const badge = document.getElementById("notifCount");
    if (!badge) return;

    const { data, error } = await supabaseClient
      .from("notifications")
      .select("created_at");

    if (error) return console.error(error);

    const unread = data.filter(n =>
      new Date(n.created_at) > new Date(lastSeen)
    ).length;

    if (unread === 0) {
      badge.style.display = "none";
    } else {
      badge.textContent = unread;
      badge.style.display = "inline-flex";
    }
  }

  /* ================= MARK AS SEEN WHEN BELL CLICKED ================= */
  const bell = document.querySelector(".notification-btn");

  if (bell) {
    bell.addEventListener("click", async () => {
      const now = new Date().toISOString();
      lastSeen = now;

      await supabaseClient
        .from("profiles")
        .upsert(
          { id: currentUser.id, last_notification_seen_at: now },
          { onConflict: "id" }
        );
    });
  }

  /* ================= REALTIME ================= */
  supabaseClient
    .channel("notif-badge")
    .on(
      "postgres_changes",
      { event:"INSERT", schema:"public", table:"notifications" },
      async () => updateBadge()
    )
    .subscribe();

  /* ================= START ================= */
  updateBadge();

});
</script>
</body>
</html>
