<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PDFs | EYES OF 3080</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;}

body{
  font-family:Segoe UI,Tahoma,sans-serif;
  background:#f4f6f5;
  color:#222;
}

/* HEADER */
header{
  background:linear-gradient(135deg,#2d5016,#4a7c2a);
  color:#fff;
  position:sticky;
  top:0;
  z-index:1000;
}

.header-container{
  max-width:1200px;
  margin:auto;
  padding:15px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.logo-wrap{
  display:flex;
  align-items:center;
  gap:10px;
  text-decoration:none;
}

.logo-img{
  width:38px;
  height:38px;
}

.logo-text{
  font-size:1.4rem;
  font-weight:bold;
  color:#fff;
}

.hamburger{
  border:none;
  background:none;
  cursor:pointer;
  display:flex;
  flex-direction:column;
  gap:5px;
}
.hamburger span{
  width:28px;
  height:3px;
  background:#fff;
  border-radius:3px;
}

/* SIDEBAR */
.sidebar{
  position:fixed;
  top:0;
  right:-300px;
  width:300px;
  height:100vh;
  background:#2d5016;
  transition:.3s;
  z-index:2000;
}
.sidebar.active{right:0}

.sidebar-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:20px;
  color:#fff;
}

.close-btn{
  background:none;
  border:none;
  color:#fff;
  font-size:2rem;
  cursor:pointer;
}

.nav-menu{
  list-style:none;
}
.nav-menu a{
  display:block;
  padding:15px 20px;
  color:#fff;
  text-decoration:none;
}
.nav-menu a:hover{
  background:rgba(255,255,255,.1);
}

.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  display:none;
}
.overlay.active{display:block}

/* PDF CARD */
.pdf-card{
  max-width:420px;
  margin:80px auto;
  background:#fff;
  border-radius:20px;
  padding:36px 28px;
  text-align:center;
  box-shadow:0 14px 35px rgba(0,0,0,.08);
}

/* LOGO - BIG */
.pdf-logo{
  width:150px;
  height:150px;
  object-fit:contain;
  margin-bottom:20px;
  border-radius:50%;
  background:#fff;
  padding:10px;
}

/* TITLE */
.pdf-title{
  font-size:1.55rem;
  font-weight:800;
  color:#2d5016;
  margin-bottom:6px;
}

.pdf-subtitle{
  font-size:.9rem;
  color:#666;
  margin-bottom:26px;
}

/* INFO (VERTICAL) */
.pdf-info.vertical{
  display:flex;
  flex-direction:column;
  gap:14px;
  margin-bottom:28px;
}

.info-block{
  background:#f0f7f2;
  padding:14px;
  border-radius:14px;
}

.info-label{
  font-size:.8rem;
  color:#4a7c2a;
  font-weight:600;
  margin-bottom:4px;
}

.info-value{
  font-size:1rem;
  font-weight:800;
  color:#2d5016;
}

/* PROGRESS BAR */
.progress-wrap{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:12px;
  width: 100%;
}

.progress-bar{
  width: 50%;             /* smaller bar width */
  max-width: 300px;
  height:16px;
  background:#e4efe7;
  border-radius:10px;
  overflow:hidden;
}

.progress-fill{
  width:0%;
  height:100%;
  background:#2d5016;
  border-radius:10px;
  
}

.loading-text{
  font-size:.85rem;
  color:#666;
  margin-top:6px;
}
</style>
</head>
<body>

<header>
  <div class="header-container">
    <a href="index.html" class="logo-wrap">
      <img src="https://zvnovocoayqomdilidte.supabase.co/storage/v1/object/public/uploads/6a8f3e57-3d27-47f5-9b5e-22a7070fc442.jpeg" class="logo-img">
      <span class="logo-text">EYES OF 3080</span>
    </a>
    <button class="hamburger" id="hamburger"><span></span><span></span><span></span></button>
  </div>
</header>

<nav class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <h3>Menu</h3>
    <button class="close-btn" id="closeBtn">&times;</button>
  </div>
  <ul class="nav-menu">
    <li><a href="news.html">Home</a></li>
    <li><a href="pdf.html">PDFs</a></li>
    <li><a href="cbt.html">CBT</a></li>
    <li><a href="marketplace.html">Marketplace</a></li>
    <li><a href="profile.html">Profile</a></li>
   </ul>
</nav>

<div class="overlay" id="overlay"></div>

<div class="pdf-card">
  <img src="https://zvnovocoayqomdilidte.supabase.co/storage/v1/object/public/uploads/6a8f3e57-3d27-47f5-9b5e-22a7070fc442.jpeg" class="pdf-logo" alt="Logo">

  <h2 class="pdf-title" id="welcomeTitle">Welcome to PDFs </h2>

  <div class="pdf-info vertical">
    <div class="info-block">
      <span class="info-label">College</span>
      <span class="info-value" id="userCollege">—</span>
    </div>
    <div class="info-block">
      <span class="info-label">Level</span>
      <span class="info-value" id="userLevel">—</span>
    </div>
  </div>

  <div class="progress-wrap">
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
    <p class="loading-text" id="loadingText">Redirecting…</p>
  </div>
</div>

<script>
/* ================= SUPABASE ================= */
const supabaseClient = supabase.createClient(
  "https://zvnovocoayqomdilidte.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp2bm92b2NvYXlxb21kaWxpZHRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQwMDM2OTgsImV4cCI6MjA3OTU3OTY5OH0.PcpwASQ3RBRoQVIglxKz-yM3iuYMZMtyQJBh8QNHad8"
);

/* ================= MENU ================= */
const hamburger = document.getElementById("hamburger");
const sidebar = document.getElementById("sidebar");
const overlay = document.getElementById("overlay");
const closeBtn = document.getElementById("closeBtn");

function toggleMenu(){
  sidebar.classList.toggle("active");
  overlay.classList.toggle("active");
}
hamburger.onclick = closeBtn.onclick = overlay.onclick = toggleMenu;

/* ================= DOM ELEMENTS ================= */
const welcomeTitle = document.getElementById("welcomeTitle");
const userCollege  = document.getElementById("userCollege");
const userLevel    = document.getElementById("userLevel");
const loadingText  = document.getElementById("loadingText");
const progressFill = document.getElementById("progressFill");

/* ================= AUTO LOAD USER & PROGRESS ================= */
async function autoRedirect(){
  try {
    const { data: { user } } = await supabaseClient.auth.getUser();

    if (!user) {
      loadingText.textContent = "Please log in to continue";
      return;
    }

    const { data: profile, error: profileError } = await supabaseClient
      .from("profiles")
      .select("full_name, college, level")
      .eq("id", user.id)
      .single();

    if (profileError || !profile) {
      loadingText.textContent = "Failed to load profile";
      return;
    }

    // Update UI
    welcomeTitle.textContent = `Welcome, ${profile.full_name}`;
    userCollege.textContent = profile.college || "—";
    userLevel.textContent = profile.level || "—";
    loadingText.textContent = "Preparing your course materials…";

    // Animate progress bar smoothly
    let percent = 0;
    const duration = 1800; // total duration in ms
    const intervalTime = 20; // update every 20ms
    const increment = (intervalTime / duration) * 100; // percent per interval

    const interval = setInterval(() => {
      percent += increment;
      if (percent > 100) percent = 100;

      progressFill.style.width = `${percent}%`;
      loadingText.textContent = `Loading ${Math.floor(percent)}%…`;

      if (percent >= 100) {
        clearInterval(interval);
        if (profile.level) {
          window.location.href = `courses.html?level=${profile.level}`;
        }
      }
    }, intervalTime);

  } catch(err) {
    console.error("Error loading user:", err);
    loadingText.textContent = "Something went wrong";
  }
}

autoRedirect();
</script>
</body>
</html>
